<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clima - Playa del Carmen</title>
  <style>
    body {

      background: none;
      font-family: Arial, sans-serif;
      //background: #eef2f3;
      display: flex;
      justify-content: top;
      align-items: top;
      height: 100vh;
      margin: 0;
    }
    .weather-widget {
      background: white;
      padding: 0px 0px;
      border-radius: 0px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      width: 160px;
      text-align: center;
    }
  
    .temp {
      font-size: 40px;
      font-weight: bold;
      margin: 0px 0 5px;
    }
    .unit-switch {
      font-size: 14px;
      color: #555;
      cursor: pointer;
      margin-left: 0px;
    }
    .details {
      font-size: 14px;
      color: #333;
      margin-top: 0px;
      text-align: left;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div class="weather-widget">
    <div id="icon"><img src="" alt="Clima"></div>
    <div>
      <span class="temp" id="temp">--</span>
      <span class="unit-switch" id="unit-switch"></span>
    </div>
    <div class="details">
      <div><strong>Humedad:</strong> <span id="humidity">--%</span></div>
      <div><strong>Viento:</strong> <span id="wind">-- km/h</span></div>
      <div><strong>Prob. lluvia:</strong> <span id="precip">--%</span></div>
    </div>
  </div>

  <script>
    const apiKey = "b687118aeb5dc56e6e08303ee837c181";
    const city = "Playa del Carmen,MX";
    const apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${apiKey}&units=metric&lang=es`;

    let currentUnit = "C"; // (C)elsius or (F)ahrenheit

    async function fetchWeather() {
      try {
        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error("Error al obtener datos del clima");
        const data = await res.json();

        const tempC = data.main.temp;
        const humidity = data.main.humidity;
        const wind = data.wind.speed * 3.6; // m/s → km/h
        const clouds = data.clouds?.all ?? null;
        const rain = data.rain?.["1h"] ? 100 : null; // o null

        // Icono oficial de OpenWeather
        const iconCode = data.weather[0].icon;
        const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;

        document.getElementById("icon").innerHTML = `<img src="${iconUrl}" alt="${data.weather[0].description}">`;

        const temp = currentUnit === "C"
          ? `${Math.round(tempC)} C`
          : `${Math.round(tempC * 9/5 + 32)} `;
        document.getElementById("temp").innerText = temp;

        document.getElementById("humidity").innerText = `${humidity}%`;
        document.getElementById("wind").innerText = `${Math.round(wind)} km/h`;

        const precipVal = rain !== null ? rain : (clouds !== null ? clouds : "--");
        document.getElementById("precip").innerText = `${precipVal !== "--" ? precipVal + "%" : "--"}`;
      } catch (err) {
        console.error(err);
        document.getElementById("temp").innerText = "Error";
      }
    }

    // Alterna unidad de temperatura
    document.getElementById("unit-switch").onclick = () => {
      currentUnit = currentUnit === "" ? "F" : "";
      document.getElementById("unit-switch").innerText = currentUnit === "" ? "" : "°F";
      fetchWeather();
    };

    fetchWeather();
    setInterval(fetchWeather, 10 * 60 * 1000); // Actualiza cada 10 minutos
  </script>
</body>
</html>
